<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voice Sampler</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="app">
    <!-- Header -->
    <header class="header">
      <h1 class="logo">Voice Sampler</h1>
      <span class="tagline">Sample and Play</span>
    </header>

    <!-- Main Content -->
    <main class="main">
      <!-- Sample Section: Record + Waveform -->
      <div class="sample-section">
        <!-- Recording Panel -->
        <section class="panel recording-section" aria-labelledby="record-heading">
          <div class="panel-header">
            <h2 id="record-heading" class="panel-title">Record</h2>
          </div>
          <div class="panel-content">
            <button id="recordBtn" class="btn-record" aria-label="Start recording">
              <span class="record-icon"></span>
              <span class="btn-text">Rec</span>
            </button>

            <div class="recording-time" id="recordingTime" aria-live="polite">00:00</div>

            <div class="level-meter" aria-label="Level meter">
              <div class="level-meter-fill" id="levelMeter"></div>
              <div class="level-meter-peak" id="levelPeak"></div>
            </div>

            <div class="recording-status" id="recordingStatus">Ready</div>
          </div>
        </section>

        <!-- Waveform Panel -->
        <section class="panel waveform-section" aria-labelledby="waveform-heading">
          <div class="panel-header">
            <h2 id="waveform-heading" class="panel-title">Sample</h2>
          </div>
          <div class="panel-content">
            <div class="waveform-container" id="waveformContainer">
              <canvas id="waveformCanvas" aria-label="Waveform display"></canvas>
              <div class="loop-region" id="loopRegion"></div>
              <div class="loop-handle loop-start" id="loopStartHandle"
                   role="slider" aria-label="Loop start" tabindex="0"></div>
              <div class="loop-handle loop-end" id="loopEndHandle"
                   role="slider" aria-label="Loop end" tabindex="0"></div>
              <div class="playhead" id="playhead"></div>
            </div>

            <div class="loop-info" id="loopInfo">
              <span>Start: <span id="loopStartTime">0.00</span>s</span>
              <span>End: <span id="loopEndTime">0.00</span>s</span>
              <span>Length: <span id="loopDuration">0.00</span>s</span>
              <button id="playSampleBtn" class="btn btn-play-sample" disabled title="Play sample at root pitch">
                <span class="play-icon"></span>
              </button>
            </div>

            <div class="sample-info" id="sampleInfo">
              <div class="info-item">
                <span class="info-label">Root</span>
                <span class="info-value" id="rootNote">--</span>
              </div>
              <div class="info-item">
                <span class="info-label">Freq</span>
                <span class="info-value" id="rootFreq">--</span>
              </div>
              <div class="info-item">
                <span class="info-label">Conf</span>
                <span class="info-value" id="pitchConfidence">--</span>
              </div>
              <div class="info-item">
                <span class="info-label">Dur</span>
                <span class="info-value" id="duration">--</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Export Panel -->
        <section class="panel export-section" aria-labelledby="export-heading">
          <div class="panel-header">
            <h2 id="export-heading" class="panel-title">Export</h2>
          </div>
          <div class="panel-content">
            <div class="export-controls">
              <!-- Performance Recording -->
              <div class="export-group">
                <div class="export-group-header">
                  <span class="export-group-title">Record Performance</span>
                  <label class="toggle toggle-small" title="Metronome">
                    <input type="checkbox" id="metronomeToggle">
                    <span class="toggle-slider"></span>
                  </label>
                </div>
                <div class="export-row">
                  <button id="perfRecordBtn" class="btn btn-record-perf" disabled>
                    <span class="perf-record-icon"></span>
                    <span class="btn-text">Record</span>
                  </button>
                  <span class="perf-record-time" id="perfRecordTime">00:00</span>
                </div>
                <div class="export-row" id="perfExportRow" hidden>
                  <button id="exportPerfWav" class="btn btn-export" disabled>WAV</button>
                  <button id="exportPerfWebm" class="btn btn-export" disabled>WebM</button>
                </div>
              </div>

              <!-- Sample Export -->
              <div class="export-group">
                <span class="export-group-title">Export Sample</span>
                <div class="export-row">
                  <select id="sampleExportType">
                    <option value="full">Full Sample</option>
                    <option value="loop">Loop Region</option>
                  </select>
                </div>
                <div class="export-row">
                  <button id="exportSampleWav" class="btn btn-export" disabled>WAV</button>
                  <button id="exportSampleWebm" class="btn btn-export" disabled>WebM</button>
                </div>
              </div>

              <!-- Metronome Volume -->
              <div class="export-group metronome-settings" id="metronomeSettings">
                <label for="metronomeVolume">Click Vol</label>
                <input type="range" id="metronomeVolume" min="0" max="100" value="50">
              </div>
            </div>
          </div>
        </section>
      </div>

      <!-- Controls Row: Amp, Keyboard, Settings -->
      <div class="controls-row">
        <!-- Amp Envelope -->
        <section class="panel envelope-section" aria-labelledby="amp-heading">
          <div class="panel-header">
            <h2 id="amp-heading" class="panel-title">Amp</h2>
          </div>
          <div class="panel-content">
            <div class="envelope-controls">
              <div class="envelope-slider">
                <label for="attackSlider">A</label>
                <input type="range" id="attackSlider" min="0" max="500" value="10">
                <span class="slider-value" id="attackValue">10</span>
              </div>
              <div class="envelope-slider">
                <label for="decaySlider">D</label>
                <input type="range" id="decaySlider" min="0" max="500" value="80">
                <span class="slider-value" id="decayValue">80</span>
              </div>
              <div class="envelope-slider">
                <label for="sustainSlider">S</label>
                <input type="range" id="sustainSlider" min="0" max="100" value="75">
                <span class="slider-value" id="sustainValue">75</span>
              </div>
              <div class="envelope-slider">
                <label for="releaseSlider">R</label>
                <input type="range" id="releaseSlider" min="0" max="1000" value="180">
                <span class="slider-value" id="releaseValue">180</span>
              </div>
            </div>
            <div class="envelope-viz">
              <canvas id="envelopeCanvas" aria-label="Envelope display"></canvas>
            </div>
          </div>
        </section>

        <!-- Keyboard -->
        <section class="panel keyboard-section" aria-labelledby="keyboard-heading">
          <div class="panel-header">
            <h2 id="keyboard-heading" class="panel-title">Keyboard</h2>
            <div class="octave-control">
              <button id="octaveDown" class="btn btn-small" aria-label="Octave down">-</button>
              <span class="octave-display" id="octaveDisplay">C4</span>
              <button id="octaveUp" class="btn btn-small" aria-label="Octave up">+</button>
            </div>
          </div>
          <div class="panel-content">
            <div class="keyboard" id="keyboard" role="group" aria-label="Virtual keyboard">
              <!-- Keys generated by JS -->
            </div>
            <div class="keyboard-hint">Keys: A S D F G H J K L</div>
          </div>
        </section>

        <!-- Tempo -->
        <section class="panel tempo-section" aria-labelledby="tempo-heading">
          <div class="panel-header">
            <h2 id="tempo-heading" class="panel-title">Tempo</h2>
            <label class="toggle toggle-small">
              <input type="checkbox" id="tempoSyncToggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="panel-content">
            <div class="tempo-controls">
              <div class="tempo-bpm">
                <label for="bpmSlider">BPM</label>
                <input type="range" id="bpmSlider" min="20" max="200" value="120">
                <input type="number" id="bpmInput" min="20" max="300" value="120" class="bpm-input">
              </div>
              <div class="tempo-division">
                <label for="noteDivisionSelect">Loop Length</label>
                <select id="noteDivisionSelect">
                  <option value="0.25">1/16 note</option>
                  <option value="0.5">1/8 note</option>
                  <option value="1" selected>1/4 note (1 beat)</option>
                  <option value="2">1/2 note (2 beats)</option>
                  <option value="4">Whole note (4 beats)</option>
                  <option value="8">2 bars (8 beats)</option>
                  <option value="16">4 bars (16 beats)</option>
                </select>
              </div>
              <div class="tempo-info">
                <span class="tempo-duration">Loop: <span id="tempoDuration">500</span>ms</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Settings -->
        <section class="panel settings-section" aria-labelledby="settings-heading">
          <div class="panel-header">
            <h2 id="settings-heading" class="panel-title">Options</h2>
          </div>
          <div class="panel-content">
            <div class="settings-grid">
              <div class="setting-item">
                <label for="polyphonySelect">Voices</label>
                <select id="polyphonySelect">
                  <option value="1">1</option>
                  <option value="4">4</option>
                  <option value="8" selected>8</option>
                  <option value="16">16</option>
                </select>
              </div>
              <div class="setting-item">
                <label for="rootNoteSelect">Root</label>
                <select id="rootNoteSelect">
                  <option value="auto" selected>Auto</option>
                  <option value="48">C3</option>
                  <option value="60">C4</option>
                  <option value="72">C5</option>
                </select>
              </div>
              <div class="setting-item">
                <label for="normalizeToggle">Normalize</label>
                <label class="toggle">
                  <input type="checkbox" id="normalizeToggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="setting-item">
                <label for="volumeSlider">Volume</label>
                <input type="range" id="volumeSlider" min="0" max="100" value="90">
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <p>Voice Sampler <span id="footerYear"></span></p>
    </footer>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay" hidden>
    <div class="loading-spinner"></div>
    <p>Processing...</p>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer" aria-live="polite"></div>

  <script type="module" src="app.js"></script>
  <script>
    document.getElementById('footerYear').textContent = new Date().getFullYear();
  </script>
</body>
</html>
